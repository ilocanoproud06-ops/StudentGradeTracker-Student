<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - AcademicPro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap");
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Plus Jakarta Sans", sans-serif;
        background: #f8fafc;
        color: #1e293b;
      }
      .sidebar {
        width: 280px;
        background: #1e293b;
        min-height: 100vh;
        position: fixed;
        left: 0;
        top: 0;
        z-index: 50;
      }
      .main-content {
        margin-left: 280px;
        min-height: 100vh;
      }
      .animate-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f5f9;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
      .grade-input {
        min-width: 80px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useMemo, useEffect } = React;

      // Icons
      const Icons = {
        LayoutDashboard: () => <i className="fas fa-th-large"></i>,
        BookOpen: () => <i className="fas fa-book-open"></i>,
        Users: () => <i className="fas fa-users"></i>,
        UserPlus: () => <i className="fas fa-user-plus"></i>,
        FileEdit: () => <i className="fas fa-file-edit"></i>,
        ClipboardList: () => <i className="fas fa-clipboard-list"></i>,
        Trash2: () => <i className="fas fa-trash-alt"></i>,
        Users2: () => <i className="fas fa-user-friends"></i>,
        LogOut: () => <i className="fas fa-sign-out-alt"></i>,
        Plus: () => <i className="fas fa-plus"></i>,
        Pencil: () => <i className="fas fa-pencil-alt"></i>,
        GraduationCap: () => <i className="fas fa-graduation-cap"></i>,
        Target: () => <i className="fas fa-bullseye"></i>,
        ChevronRight: () => <i className="fas fa-chevron-right"></i>,
        Calendar: () => <i className="fas fa-calendar-alt"></i>,
        Filter: () => <i className="fas fa-filter"></i>,
        Save: () => <i className="fas fa-save"></i>,
        Download: () => <i className="fas fa-download"></i>,
        Search: () => <i className="fas fa-search"></i>,
        X: () => <i className="fas fa-times"></i>,
        Check: () => <i className="fas fa-check"></i>,
        Edit: () => <i className="fas fa-edit"></i>,
        Clock: () => <i className="fas fa-clock"></i>,
        MapPin: () => <i className="fas fa-map-marker-alt"></i>,
        Book: () => <i className="fas fa-book"></i>,
      };

      function NavItem({ icon, label, active, onClick }) {
        return (
          <button
            onClick={onClick}
            className={`w-full flex items-center gap-4 px-5 py-4 rounded-2xl transition-all group ${active ? "bg-blue-600 text-white shadow-xl shadow-blue-600/30" : "text-slate-400 hover:text-white hover:bg-slate-700/50"}`}
          >
            <span
              className={`${active ? "text-white" : "text-slate-500 group-hover:text-blue-400"} transition-colors`}
            >
              {icon}
            </span>
            <span className="text-sm font-bold tracking-tight">{label}</span>
          </button>
        );
      }

      // Modal Component
      function Modal({ isOpen, onClose, title, children, size = "lg" }) {
        if (!isOpen) return null;
        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center">
            <div
              className="absolute inset-0 bg-black/50 backdrop-blur-sm"
              onClick={onClose}
            ></div>
            <div
              className={`relative bg-white rounded-3xl shadow-2xl max-h-[90vh] overflow-hidden ${size === "xl" ? "max-w-4xl w-full" : "max-w-lg w-full"} animate-in`}
            >
              <div className="flex items-center justify-between p-6 border-b border-slate-100">
                <h3 className="text-xl font-black text-slate-800">{title}</h3>
                <button
                  onClick={onClose}
                  className="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center text-slate-500 hover:bg-red-500 hover:text-white transition-all"
                >
                  <Icons.X />
                </button>
              </div>
              <div className="p-6 overflow-y-auto max-h-[70vh]">{children}</div>
            </div>
          </div>
        );
      }

      // Main App
      function App() {
        const [activeTab, setActiveTab] = useState("Enrollment");
        const [selectedCourseId, setSelectedCourseId] = useState(1);
        const [selectedMonth, setSelectedMonth] = useState("February");
        const [store, setStore] = useState(null);
        const [loading, setLoading] = useState(true);

        // Load data
        useEffect(() => {
          async function loadData() {
            try {
              const data = await SyncManager.loadData();
              setStore(SyncManager.ensureDefaultStructure(data));
            } catch (error) {
              console.error("Error loading data:", error);
              setStore(getDefaultData());
            } finally {
              setLoading(false);
            }
          }
          loadData();
        }, []);

        // Default data - matching data.json format
        function getDefaultData() {
          return {
            students: [
              {
                id: 1,
                studentIdNum: "2024-0001",
                name: "Garcia, Maria S.",
                program: "BSCS",
                email: "garcia@edu.ph",
                yearLevel: "3rd Year",
              },
              {
                id: 2,
                studentIdNum: "2024-0002",
                name: "Wilson, James K.",
                program: "BSIT",
                email: "wilson@edu.ph",
                yearLevel: "2nd Year",
              },
              {
                id: 3,
                studentIdNum: "2024-0003",
                name: "Chen, Robert L.",
                program: "BS MATH",
                email: "chen@edu.ph",
                yearLevel: "4th Year",
              },
              {
                id: 4,
                studentIdNum: "2024-0004",
                name: "Brown, Sarah M.",
                program: "BSCS",
                email: "brown@edu.ph",
                yearLevel: "3rd Year",
              },
              {
                id: 5,
                studentIdNum: "2024-0005",
                name: "Davis, Michael R.",
                program: "BSIT",
                email: "davis@edu.ph",
                yearLevel: "2nd Year",
              },
            ],
            courses: [
              {
                id: 1,
                code: "IT101",
                title: "Introduction to IT",
                type: "Lecture",
                schedule: "MWF 9:00-10:00",
                room: "Room 101",
                instructor: "Prof. Smith",
              },
              {
                id: 2,
                code: "CS201",
                title: "Data Structures",
                type: "Laboratory",
                schedule: "TTh 1:00-3:00",
                room: "Lab 102",
                instructor: "Prof. Johnson",
              },
              {
                id: 3,
                code: "IT302",
                title: "Web Development",
                type: "Laboratory",
                schedule: "Fri 9:00-4:00",
                room: "Lab 301",
                instructor: "Prof. Williams",
              },
            ],
            enrollments: [
              { id: "en-1", studentId: 1, courseId: 1 },
              { id: "en-2", studentId: 1, courseId: 2 },
              { id: "en-3", studentId: 2, courseId: 1 },
              { id: "en-4", studentId: 3, courseId: 1 },
              { id: "en-5", studentId: 3, courseId: 3 },
              { id: "en-6", studentId: 4, courseId: 1 },
              { id: "en-7", studentId: 4, courseId: 2 },
              { id: "en-8", studentId: 5, courseId: 2 },
            ],
            assessments: [
              {
                id: 501,
                courseId: 1,
                category: "Written Exam",
                title: "Prelim Exam",
                month: "February",
                hps: 100,
              },
              {
                id: 502,
                courseId: 1,
                category: "Quiz",
                title: "Quiz 1",
                month: "February",
                hps: 50,
              },
              {
                id: 503,
                courseId: 1,
                category: "Performance Task",
                title: "Seatwork 1",
                month: "February",
                hps: 20,
              },
              {
                id: 504,
                courseId: 2,
                category: "Laboratory",
                title: "Lab 1",
                month: "February",
                hps: 50,
              },
              {
                id: 505,
                courseId: 2,
                category: "Laboratory",
                title: "Lab 2",
                month: "February",
                hps: 50,
              },
              {
                id: 506,
                courseId: 3,
                category: "Written Exam",
                title: "Midterm",
                month: "February",
                hps: 100,
              },
            ],
            grades: {
              "1_1": { 501: 95, 502: 45, 503: 18 },
              "2_1": { 501: 88, 502: 40 },
              "3_1": { 501: 92, 502: 48, 503: 20 },
              "1_2": { 504: 48 },
              "4_1": { 501: 78, 502: 35 },
            },
            gradingScale: [
              { min: 95, max: 100, label: "A" },
              { min: 90, max: 94, label: "A-" },
              { min: 85, max: 89, label: "B+" },
              { min: 80, max: 84, label: "B" },
              { min: 75, max: 79, label: "B-" },
              { min: 70, max: 74, label: "C+" },
              { min: 65, max: 69, label: "C" },
              { min: 60, max: 64, label: "C-" },
              { min: 55, max: 59, label: "D" },
              { min: 0, max: 54, label: "F" },
            ],
          };
        }

        const data = store || getDefaultData();

        // ========== COURSES CRUD ==========
        const [courseModal, setCourseModal] = useState({
          open: false,
          mode: "add",
          data: {},
        });

        const handleSaveCourse = (course) => {
          let newCourses;
          if (courseModal.mode === "add") {
            newCourses = [...data.courses, { ...course, id: Date.now() }];
          } else {
            newCourses = data.courses.map((c) =>
              c.id === course.id ? course : c,
            );
          }
          updateStore({ courses: newCourses });
          setCourseModal({ open: false, mode: "add", data: {} });
        };

        const handleDeleteCourse = (id) => {
          if (confirm("Delete this course?")) {
            updateStore({ courses: data.courses.filter((c) => c.id !== id) });
          }
        };

        // ========== ENROLLMENT SYSTEM ==========
        const [enrollmentModal, setEnrollmentModal] = useState({
          open: false,
          studentId: null,
        });

        // Enroll a student in courses (CREATE)
        const handleEnrollStudent = async (studentId, courseIds) => {
          if (!studentId || !courseIds || courseIds.length === 0) {
            alert("Please select a student and at least one course");
            return;
          }

          try {
            const parsedStudentId = parseInt(studentId);
            const existingEnrollments = data.enrollments.filter(
              (e) => e.studentId === parsedStudentId,
            );

            const newEnrollments = courseIds
              .map((cid) => ({
                id: `en-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                studentId: parsedStudentId,
                courseId: parseInt(cid),
              }))
              .filter(
                (newEn) =>
                  !existingEnrollments.some(
                    (ex) => ex.courseId === newEn.courseId,
                  ),
              );

            if (newEnrollments.length === 0) {
              alert("Student is already enrolled in all selected courses.");
              return;
            }

            const updatedEnrollments = [...data.enrollments, ...newEnrollments];

            // Update state first (immediate UI update)
            setStore((prev) => ({ ...prev, enrollments: updatedEnrollments }));

            // Then save to storage
            const storeToSave = { ...data, enrollments: updatedEnrollments };
            storeToSave._lastModified = new Date().toISOString();
            localStorage.setItem(
              "academic_grade_system_v1",
              JSON.stringify(storeToSave),
            );

            // Show success message
            alert(
              `Successfully enrolled student in ${newEnrollments.length} course(s)!`,
            );

            // Reset the wizard form
            const studentSelect = document.getElementById("wizardStudent");
            if (studentSelect) studentSelect.value = "";
            document
              .querySelectorAll('input[id^="course-"]')
              .forEach((cb) => (cb.checked = false));

            console.log(
              "Enrollment saved. Total enrollments:",
              updatedEnrollments.length,
            );
          } catch (error) {
            console.error("Error enrolling student:", error);
            alert("Error enrolling student. Please try again.");
          }
        };

        // Unenroll a student from a course (DELETE)
        const handleUnenroll = (enrollmentId) => {
          if (
            confirm(
              "Are you sure you want to unenroll this student from this course?",
            )
          ) {
            try {
              const updatedEnrollments = data.enrollments.filter(
                (e) => e.id !== enrollmentId,
              );

              // Update state
              setStore((prev) => ({
                ...prev,
                enrollments: updatedEnrollments,
              }));

              // Save to storage
              const storeToSave = { ...data, enrollments: updatedEnrollments };
              storeToSave._lastModified = new Date().toISOString();
              localStorage.setItem(
                "academic_grade_system_v1",
                JSON.stringify(storeToSave),
              );

              alert("Student has been unenrolled successfully!");
              console.log(
                "Unenrolled. Total enrollments:",
                updatedEnrollments.length,
              );
            } catch (error) {
              console.error("Error unenrolling student:", error);
              alert("Error unenrolling student. Please try again.");
            }
          }
        };

        // Add course to student (alternative method via modal)
        const handleAddCourseToStudent = (studentId, courseId) => {
          const parsedStudentId = parseInt(studentId);
          const parsedCourseId = parseInt(courseId);

          // Check if already enrolled
          const exists = data.enrollments.some(
            (e) =>
              e.studentId === parsedStudentId && e.courseId === parsedCourseId,
          );

          if (exists) {
            alert("Student is already enrolled in this course!");
            return;
          }

          const newEnrollment = {
            id: `en-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
            studentId: parsedStudentId,
            courseId: parsedCourseId,
          };

          const updatedEnrollments = [...data.enrollments, newEnrollment];
          setStore((prev) => ({ ...prev, enrollments: updatedEnrollments }));

          // Save to storage
          const storeToSave = { ...data, enrollments: updatedEnrollments };
          storeToSave._lastModified = new Date().toISOString();
          localStorage.setItem(
            "academic_grade_system_v1",
            JSON.stringify(storeToSave),
          );

          alert("Course added successfully!");
          setEnrollmentModal({ open: false, studentId: null });
        };

        // ========== ASSESSMENTS & HPS ==========
        const [assessmentModal, setAssessmentModal] = useState({
          open: false,
          mode: "add",
          data: {},
        });

        const handleSaveAssessment = (assessment) => {
          let newAssessments;
          if (assessmentModal.mode === "add") {
            newAssessments = [
              ...data.assessments,
              { ...assessment, id: Date.now() },
            ];
          } else {
            newAssessments = data.assessments.map((a) =>
              a.id === assessment.id ? assessment : a,
            );
          }
          updateStore({ assessments: newAssessments });
          setAssessmentModal({ open: false, mode: "add", data: {} });
        };

        const handleDeleteAssessment = (id) => {
          if (confirm("Delete this assessment?")) {
            updateStore({
              assessments: data.assessments.filter((a) => a.id !== id),
            });
          }
        };

        // ========== GRADE ENTRY ==========
        const getGrade = (studentId, courseId, assessmentId) => {
          const key = `${studentId}_${courseId}`;
          return data.grades[key]?.[assessmentId] || "";
        };

        const updateGrade = (studentId, courseId, assessmentId, score) => {
          const key = `${studentId}_${courseId}`;
          const newGrades = { ...data.grades };
          if (!newGrades[key]) newGrades[key] = {};
          newGrades[key][assessmentId] = score === "" ? "" : parseFloat(score);
          updateStore({ grades: newGrades });
        };

        // ========== HELPERS ==========
        function updateStore(updates) {
          const newStore = { ...data, ...updates };
          setStore(newStore);
          // Save to localStorage and optionally to Firebase
          SyncManager.quickSave(newStore);
          console.log("Data saved - enrollments:", newStore.enrollments.length);
        }

        const getLetterGrade = (percentage) => {
          const scale = data.gradingScale || [];
          return (
            scale.find((s) => percentage >= s.min && percentage <= s.max)
              ?.label || "N/A"
          );
        };

        const studentsInCourse = useMemo(() => {
          const enrolledIds = data.enrollments
            .filter((e) => e.courseId === selectedCourseId)
            .map((e) => e.studentId);
          if (enrolledIds.length === 0) return data.students.slice(0, 3);
          return data.students.filter((s) => enrolledIds.includes(s.id));
        }, [data, selectedCourseId]);

        const filteredAssessments = useMemo(
          () =>
            data.assessments.filter(
              (a) =>
                a.courseId === selectedCourseId && a.month === selectedMonth,
            ),
          [data, selectedCourseId, selectedMonth],
        );

        // ========== RENDERERS ==========

        // COURSES TAB
        const renderCourses = () => (
          <div className="space-y-6 animate-in">
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-black text-slate-800">
                  Course Management
                </h2>
                <p className="text-xs text-slate-400 font-medium uppercase tracking-widest mt-1">
                  Manage all academic courses
                </p>
              </div>
              <button
                onClick={() =>
                  setCourseModal({ open: true, mode: "add", data: {} })
                }
                className="flex items-center gap-2 px-5 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-all"
              >
                <Icons.Plus /> Add Course
              </button>
            </div>

            <div className="grid gap-4">
              {data.courses.map((course) => (
                <div
                  key={course.id}
                  className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 hover:shadow-md transition-all"
                >
                  <div className="flex items-start justify-between">
                    <div className="flex items-start gap-4">
                      <div
                        className={`w-14 h-14 rounded-2xl flex items-center justify-center ${course.type === "Laboratory" ? "bg-purple-100 text-purple-600" : "bg-blue-100 text-blue-600"}`}
                      >
                        <Icons.Book />
                      </div>
                      <div>
                        <h3 className="text-lg font-black text-slate-800">
                          {course.code} - {course.title}
                        </h3>
                        <p className="text-sm text-slate-500 mt-1">
                          {course.type}
                        </p>
                        <div className="flex gap-4 mt-3 text-xs text-slate-400">
                          <span className="flex items-center gap-1">
                            <Icons.Calendar /> {course.schedule}
                          </span>
                          <span className="flex items-center gap-1">
                            <Icons.MapPin /> {course.room}
                          </span>
                          <span className="flex items-center gap-1">
                            <i className="fas fa-user"></i> {course.instructor}
                          </span>
                        </div>
                      </div>
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={() =>
                          setCourseModal({
                            open: true,
                            mode: "edit",
                            data: course,
                          })
                        }
                        className="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center text-slate-500 hover:bg-blue-500 hover:text-white transition-all"
                      >
                        <Icons.Edit />
                      </button>
                      <button
                        onClick={() => handleDeleteCourse(course.id)}
                        className="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center text-slate-500 hover:bg-red-500 hover:text-white transition-all"
                      >
                        <Icons.Trash2 />
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>

            <Modal
              isOpen={courseModal.open}
              onClose={() =>
                setCourseModal({ open: false, mode: "add", data: {} })
              }
              title={
                courseModal.mode === "add" ? "Add New Course" : "Edit Course"
              }
            >
              <div className="space-y-4">
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      Course Code
                    </label>
                    <input
                      value={courseModal.data.code || ""}
                      onChange={(e) =>
                        setCourseModal({
                          ...courseModal,
                          data: { ...courseModal.data, code: e.target.value },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      placeholder="MATH101"
                    />
                  </div>
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      Title
                    </label>
                    <input
                      value={courseModal.data.title || ""}
                      onChange={(e) =>
                        setCourseModal({
                          ...courseModal,
                          data: { ...courseModal.data, title: e.target.value },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      placeholder="Mathematics 101"
                    />
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      Type
                    </label>
                    <select
                      value={courseModal.data.type || "Lecture"}
                      onChange={(e) =>
                        setCourseModal({
                          ...courseModal,
                          data: { ...courseModal.data, type: e.target.value },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                    >
                      <option>Lecture</option>
                      <option>Laboratory</option>
                    </select>
                  </div>
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      Schedule
                    </label>
                    <input
                      value={courseModal.data.schedule || ""}
                      onChange={(e) =>
                        setCourseModal({
                          ...courseModal,
                          data: {
                            ...courseModal.data,
                            schedule: e.target.value,
                          },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      placeholder="MWF 9:00-10:00"
                    />
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      Room
                    </label>
                    <input
                      value={courseModal.data.room || ""}
                      onChange={(e) =>
                        setCourseModal({
                          ...courseModal,
                          data: { ...courseModal.data, room: e.target.value },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      placeholder="Room 301"
                    />
                  </div>
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      Instructor
                    </label>
                    <input
                      value={courseModal.data.instructor || ""}
                      onChange={(e) =>
                        setCourseModal({
                          ...courseModal,
                          data: {
                            ...courseModal.data,
                            instructor: e.target.value,
                          },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      placeholder="Dr. Smith"
                    />
                  </div>
                </div>
                <button
                  onClick={() => handleSaveCourse(courseModal.data)}
                  className="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 mt-4"
                >
                  Save Course
                </button>
              </div>
            </Modal>
          </div>
        );

        // ENROLLMENT TAB
        const renderEnrollment = () => {
          const [searchTerm, setSearchTerm] = useState("");

          const filteredStudents = data.students.filter(
            (s) =>
              s.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
              s.studentIdNum.includes(searchTerm),
          );

          return (
            <div className="space-y-6 animate-in">
              <div className="flex items-center justify-between">
                <div>
                  <h2 className="text-2xl font-black text-slate-800">
                    Enrollment Management
                  </h2>
                  <p className="text-xs text-slate-400 font-medium uppercase tracking-widest mt-1">
                    Enroll students in courses
                  </p>
                </div>
              </div>

              <div className="grid grid-cols-3 gap-6">
                <div className="col-span-1 bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                  <h3 className="font-black text-slate-800 mb-4">
                    Enrollment Wizard
                  </h3>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                        Select Student
                      </label>
                      <select
                        id="wizardStudent"
                        className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      >
                        <option value="">Choose student...</option>
                        {data.students.map((s) => (
                          <option key={s.id} value={s.id}>
                            {s.name} ({s.studentIdNum})
                          </option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                        Select Courses
                      </label>
                      <div className="space-y-2 max-h-48 overflow-y-auto">
                        {data.courses.map((c) => (
                          <label
                            key={c.id}
                            className="flex items-center gap-3 p-3 rounded-xl border border-slate-200 hover:bg-slate-50 cursor-pointer"
                          >
                            <input
                              type="checkbox"
                              className="w-5 h-5 rounded"
                              id={`course-${c.id}`}
                            />
                            <span className="font-bold text-sm">
                              {c.code} - {c.title}
                            </span>
                          </label>
                        ))}
                      </div>
                    </div>
                    <button
                      onClick={() => {
                        const studentId =
                          document.getElementById("wizardStudent").value;
                        const courseIds = Array.from(
                          document.querySelectorAll(
                            'input[id^="course-"]:checked',
                          ),
                        ).map((cb) => cb.id.replace("course-", ""));

                        console.log(
                          "Enrolling student:",
                          studentId,
                          "in courses:",
                          courseIds,
                        );
                        console.log("Current enrollments:", data.enrollments);

                        if (studentId && courseIds.length > 0)
                          handleEnrollStudent(studentId, courseIds);
                        else
                          alert(
                            "Please select a student and at least one course",
                          );
                      }}
                      className="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700"
                    >
                      Enroll Student
                    </button>
                  </div>
                </div>

                <div className="col-span-2 bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                  <h3 className="font-black text-slate-800 mb-4">
                    Current Enrollments
                  </h3>
                  <div className="mb-4 relative">
                    <Icons.Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" />
                    <input
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      placeholder="Search students..."
                      className="w-full pl-12 pr-4 py-3 rounded-xl border border-slate-200 font-bold"
                    />
                  </div>
                  <div className="space-y-2 max-h-[500px] overflow-y-auto">
                    {filteredStudents.map((student) => {
                      const studentCourses = data.courses.filter((c) =>
                        data.enrollments.some(
                          (e) =>
                            e.studentId === student.id && e.courseId === c.id,
                        ),
                      );
                      return (
                        <div
                          key={student.id}
                          className="p-4 rounded-xl border border-slate-200"
                        >
                          <div className="flex items-center justify-between mb-2">
                            <div>
                              <h4 className="font-bold text-slate-800">
                                {student.name}
                              </h4>
                              <p className="text-xs text-slate-400">
                                {student.studentIdNum} • {student.program}
                              </p>
                            </div>
                            <button
                              onClick={() =>
                                setEnrollmentModal({
                                  open: true,
                                  studentId: student.id,
                                })
                              }
                              className="px-4 py-2 bg-blue-100 text-blue-600 rounded-xl text-xs font-bold hover:bg-blue-600 hover:text-white transition-all"
                            >
                              + Add Course
                            </button>
                          </div>
                          <div className="flex flex-wrap gap-2">
                            {studentCourses.map((c) => {
                              const enId = data.enrollments.find(
                                (e) =>
                                  e.studentId === student.id &&
                                  e.courseId === c.id,
                              )?.id;
                              return (
                                <span
                                  key={c.id}
                                  className="px-3 py-1 bg-slate-100 rounded-full text-xs font-bold flex items-center gap-2"
                                >
                                  {c.code}
                                  <button
                                    onClick={() => handleUnenroll(enId)}
                                    className="text-slate-400 hover:text-red-500"
                                  >
                                    <Icons.X />
                                  </button>
                                </span>
                              );
                            })}
                            {studentCourses.length === 0 && (
                              <span className="text-xs text-slate-400 italic">
                                Not enrolled
                              </span>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // ASSESSMENTS TAB
        const renderAssessments = () => (
          <div className="space-y-6 animate-in">
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-black text-slate-800">
                  Assessment & HPS Management
                </h2>
                <p className="text-xs text-slate-400 font-medium uppercase tracking-widest mt-1">
                  Define tasks and their High Possible Scores
                </p>
              </div>
              <button
                onClick={() =>
                  setAssessmentModal({ open: true, mode: "add", data: {} })
                }
                className="flex items-center gap-2 px-5 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-all"
              >
                <Icons.Plus /> Add Assessment
              </button>
            </div>

            <div className="grid grid-cols-2 gap-4">
              {data.courses.map((course) => {
                const courseAssessments = data.assessments.filter(
                  (a) => a.courseId === course.id,
                );
                return (
                  <div
                    key={course.id}
                    className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200"
                  >
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="font-black text-slate-800">
                        {course.code}
                      </h3>
                      <span className="px-3 py-1 bg-blue-100 text-blue-600 rounded-full text-xs font-bold">
                        {courseAssessments.length} tasks
                      </span>
                    </div>
                    <div className="space-y-2">
                      {courseAssessments.map((a) => (
                        <div
                          key={a.id}
                          className="flex items-center justify-between p-3 rounded-xl bg-slate-50"
                        >
                          <div>
                            <p className="font-bold text-sm text-slate-800">
                              {a.title}
                            </p>
                            <p className="text-xs text-slate-400">
                              {a.category} • {a.month}
                            </p>
                          </div>
                          <div className="flex items-center gap-3">
                            <span className="px-3 py-1 bg-emerald-100 text-emerald-600 rounded-full text-xs font-bold">
                              HPS: {a.hps}
                            </span>
                            <button
                              onClick={() =>
                                setAssessmentModal({
                                  open: true,
                                  mode: "edit",
                                  data: a,
                                })
                              }
                              className="text-slate-400 hover:text-blue-500"
                            >
                              <Icons.Edit />
                            </button>
                            <button
                              onClick={() => handleDeleteAssessment(a.id)}
                              className="text-slate-400 hover:text-red-500"
                            >
                              <Icons.Trash2 />
                            </button>
                          </div>
                        </div>
                      ))}
                      {courseAssessments.length === 0 && (
                        <p className="text-sm text-slate-400 italic">
                          No assessments defined
                        </p>
                      )}
                    </div>
                  </div>
                );
              })}
            </div>

            <Modal
              isOpen={assessmentModal.open}
              onClose={() =>
                setAssessmentModal({ open: false, mode: "add", data: {} })
              }
              title={
                assessmentModal.mode === "add"
                  ? "Add New Assessment"
                  : "Edit Assessment"
              }
            >
              <div className="space-y-4">
                <div>
                  <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                    Course
                  </label>
                  <select
                    value={assessmentModal.data.courseId || ""}
                    onChange={(e) =>
                      setAssessmentModal({
                        ...assessmentModal,
                        data: {
                          ...assessmentModal.data,
                          courseId: parseInt(e.target.value),
                        },
                      })
                    }
                    className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                  >
                    <option value="">Select course...</option>
                    {data.courses.map((c) => (
                      <option key={c.id} value={c.id}>
                        {c.code} - {c.title}
                      </option>
                    ))}
                  </select>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      Category
                    </label>
                    <select
                      value={assessmentModal.data.category || "Quiz"}
                      onChange={(e) =>
                        setAssessmentModal({
                          ...assessmentModal,
                          data: {
                            ...assessmentModal.data,
                            category: e.target.value,
                          },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                    >
                      <option>Written Exam</option>
                      <option>Quiz</option>
                      <option>Performance Task</option>
                      <option>Laboratory</option>
                      <option>Project</option>
                    </select>
                  </div>
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      Month
                    </label>
                    <select
                      value={assessmentModal.data.month || "February"}
                      onChange={(e) =>
                        setAssessmentModal({
                          ...assessmentModal,
                          data: {
                            ...assessmentModal.data,
                            month: e.target.value,
                          },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                    >
                      {[
                        "January",
                        "February",
                        "March",
                        "April",
                        "May",
                        "June",
                        "July",
                        "August",
                        "September",
                        "October",
                        "November",
                        "December",
                      ].map((m) => (
                        <option key={m}>{m}</option>
                      ))}
                    </select>
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      Title
                    </label>
                    <input
                      value={assessmentModal.data.title || ""}
                      onChange={(e) =>
                        setAssessmentModal({
                          ...assessmentModal,
                          data: {
                            ...assessmentModal.data,
                            title: e.target.value,
                          },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      placeholder="Quiz 1"
                    />
                  </div>
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      HPS (High Possible Score)
                    </label>
                    <input
                      type="number"
                      value={assessmentModal.data.hps || ""}
                      onChange={(e) =>
                        setAssessmentModal({
                          ...assessmentModal,
                          data: {
                            ...assessmentModal.data,
                            hps: parseInt(e.target.value),
                          },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      placeholder="50"
                    />
                  </div>
                </div>
                <button
                  onClick={() => handleSaveAssessment(assessmentModal.data)}
                  className="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 mt-4"
                >
                  Save Assessment
                </button>
              </div>
            </Modal>
          </div>
        );

        // GRADE ENTRY TAB - Excel-Style
        const renderGradeEntry = () => {
          const calculateAverage = (studentId) => {
            let totalEarned = 0,
              totalHps = 0;
            filteredAssessments.forEach((a) => {
              const score = getGrade(studentId, selectedCourseId, a.id);
              if (score !== "" && score !== null) {
                totalEarned += score;
                totalHps += a.hps;
              }
            });
            return totalHps > 0
              ? Math.round((totalEarned / totalHps) * 100)
              : 0;
          };

          return (
            <div className="space-y-6 animate-in">
              <div className="flex flex-col md:flex-row md:items-end justify-between gap-6">
                <div>
                  <h2 className="text-2xl font-black text-slate-800">
                    Grade Entry Spreadsheet
                  </h2>
                  <p className="text-xs text-slate-400 font-medium uppercase tracking-widest mt-1">
                    Excel-Style Manual Entry Mode
                  </p>
                </div>
                <div className="flex items-center gap-3 bg-white p-2 rounded-[24px] shadow-sm border border-slate-200">
                  <div className="flex items-center gap-2 px-4 py-2 bg-slate-50 rounded-xl border border-slate-100">
                    <Icons.Filter />
                    <select
                      value={selectedCourseId}
                      onChange={(e) =>
                        setSelectedCourseId(parseInt(e.target.value))
                      }
                      className="bg-transparent text-xs font-black text-slate-700 outline-none"
                    >
                      {data.courses.map((c) => (
                        <option key={c.id} value={c.id}>
                          {c.code} - {c.title}
                        </option>
                      ))}
                    </select>
                  </div>
                  <div className="flex items-center gap-2 px-4 py-2 bg-slate-50 rounded-xl border border-slate-100">
                    <Icons.Calendar />
                    <select
                      value={selectedMonth}
                      onChange={(e) => setSelectedMonth(e.target.value)}
                      className="bg-transparent text-xs font-black text-slate-700 outline-none"
                    >
                      {[
                        "January",
                        "February",
                        "March",
                        "April",
                        "May",
                        "June",
                        "July",
                        "August",
                        "September",
                        "October",
                        "November",
                        "December",
                      ].map((m) => (
                        <option key={m}>{m}</option>
                      ))}
                    </select>
                  </div>
                </div>
              </div>

              <div className="bg-white rounded-[32px] shadow-xl shadow-slate-200/50 border border-slate-200 overflow-hidden">
                <div className="overflow-x-auto">
                  <table className="w-full border-collapse">
                    <thead>
                      <tr className="bg-slate-900 text-white">
                        <th className="sticky left-0 z-10 bg-slate-900 px-8 py-6 text-left border-r border-slate-800 min-w-[280px]">
                          <div className="text-[10px] font-black text-slate-500 uppercase tracking-[2px]">
                            Student Info
                          </div>
                        </th>
                        {filteredAssessments.map((a) => (
                          <th
                            key={a.id}
                            className="px-4 py-6 text-center border-r border-slate-800 min-w-[120px]"
                          >
                            <div className="text-[10px] font-black text-blue-400 uppercase mb-1">
                              {a.category}
                            </div>
                            <div className="text-xs font-black tracking-tight">
                              {a.title}
                            </div>
                            <div className="text-[10px] font-bold text-slate-500 mt-1 italic">
                              HPS: {a.hps}
                            </div>
                          </th>
                        ))}
                        <th className="px-8 py-6 text-center bg-indigo-900/50 min-w-[120px]">
                          <div className="text-[10px] font-black text-indigo-300 uppercase">
                            Average
                          </div>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {studentsInCourse.map((student, sIdx) => {
                        const avg = calculateAverage(student.id);
                        return (
                          <tr
                            key={student.id}
                            className="group hover:bg-blue-50/30 transition-colors border-b border-slate-100"
                          >
                            <td className="sticky left-0 z-10 bg-white group-hover:bg-blue-50/30 px-8 py-4 border-r border-slate-100">
                              <div className="flex items-center gap-3">
                                <div className="w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center text-[10px] font-black text-slate-500">
                                  {sIdx + 1}
                                </div>
                                <div>
                                  <div className="text-sm font-bold text-slate-800">
                                    {student.name}
                                  </div>
                                  <div className="text-[10px] font-black text-slate-400 uppercase">
                                    {student.studentIdNum || student.idNum}
                                  </div>
                                </div>
                              </div>
                            </td>
                            {filteredAssessments.map((a) => {
                              const score = getGrade(
                                student.id,
                                selectedCourseId,
                                a.id,
                              );
                              return (
                                <td
                                  key={a.id}
                                  className="px-2 py-3 border-r border-slate-50 text-center"
                                >
                                  <input
                                    type="number"
                                    max={a.hps}
                                    value={score}
                                    onChange={(e) =>
                                      updateGrade(
                                        student.id,
                                        selectedCourseId,
                                        a.id,
                                        e.target.value,
                                      )
                                    }
                                    className="w-20 px-3 py-2 bg-slate-50 rounded-xl text-center text-sm font-black text-slate-800 focus:bg-white focus:ring-4 focus:ring-blue-100 focus:border-blue-500 outline-none transition-all border-2 border-transparent"
                                    placeholder="-"
                                  />
                                </td>
                              );
                            })}
                            <td className="px-8 py-4 text-center bg-slate-50/50">
                              <div className="font-black text-indigo-600 text-sm">
                                {avg}%
                                <span className="ml-2 text-xs text-slate-400">
                                  {getLetterGrade(avg)}
                                </span>
                              </div>
                            </td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>

                {studentsInCourse.length === 0 && (
                  <div className="py-20 flex flex-col items-center justify-center bg-slate-50/30">
                    <Icons.Users2 />
                    <p className="text-slate-400 font-bold text-sm mt-4">
                      No students enrolled in this course.
                    </p>
                  </div>
                )}

                <div className="p-6 bg-slate-50 border-t border-slate-200 flex justify-between items-center">
                  <div className="flex gap-4">
                    <div className="flex items-center gap-2">
                      <div className="w-3 h-3 rounded-full bg-blue-500 animate-pulse"></div>
                      <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">
                        Auto-Saving Enabled
                      </span>
                    </div>
                  </div>
                  <div className="flex gap-3">
                    <button
                      onClick={() => SyncManager.exportData()}
                      className="flex items-center gap-2 px-5 py-2.5 bg-white border border-slate-200 rounded-xl text-[10px] font-black text-slate-600 uppercase tracking-widest hover:bg-slate-100"
                    >
                      <Icons.Download /> Export CSV
                    </button>
                    <button className="flex items-center gap-2 px-6 py-2.5 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-black shadow-lg">
                      <Icons.Save /> Finalize Grades
                    </button>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // ========== STUDENTS CRUD ==========
        const [studentModal, setStudentModal] = useState({
          open: false,
          mode: "add",
          data: {},
        });

        // Generate unique student ID
        const generateStudentId = () => {
          const year = new Date().getFullYear();
          const randomNum = Math.floor(1000 + Math.random() * 9000);
          return `${year}-${randomNum}`;
        };

        // Generate 6-digit PIN
        const generatePIN = () => {
          return Math.floor(100000 + Math.random() * 900000).toString();
        };

        const handleSaveStudent = (student) => {
          let newStudents;
          if (studentModal.mode === "add") {
            newStudents = [
              ...data.students,
              {
                ...student,
                id: Date.now(),
                studentIdNum: student.studentIdNum || generateStudentId(),
                pin: student.pin || generatePIN(),
              },
            ];
          } else {
            newStudents = data.students.map((s) =>
              s.id === student.id ? student : s,
            );
          }
          // Sort alphabetically
          newStudents.sort((a, b) => a.name.localeCompare(b.name));
          updateStore({ students: newStudents });
          setStudentModal({ open: false, mode: "add", data: {} });
        };

        const handleDeleteStudent = (id) => {
          if (
            confirm(
              "Delete this student? This will also remove all their enrollments.",
            )
          ) {
            updateStore({
              students: data.students.filter((s) => s.id !== id),
              enrollments: data.enrollments.filter((e) => e.studentId !== id),
            });
          }
        };

        // STUDENTS TAB
        const renderStudents = () => {
          const sortedStudents = [...data.students].sort((a, b) =>
            a.name.localeCompare(b.name),
          );

          return (
            <div className="space-y-6 animate-in">
              <div className="flex items-center justify-between">
                <div>
                  <h2 className="text-2xl font-black text-slate-800">
                    Student Management
                  </h2>
                  <p className="text-xs text-slate-400 font-medium uppercase tracking-widest mt-1">
                    Register and manage students
                  </p>
                </div>
                <button
                  onClick={() =>
                    setStudentModal({
                      open: true,
                      mode: "add",
                      data: {
                        studentIdNum: generateStudentId(),
                        pin: generatePIN(),
                      },
                    })
                  }
                  className="flex items-center gap-2 px-5 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-all"
                >
                  <Icons.Plus /> Register Student
                </button>
              </div>

              <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <table className="w-full">
                  <thead className="bg-slate-50 border-b border-slate-200">
                    <tr>
                      <th className="px-6 py-4 text-left text-xs font-black text-slate-500 uppercase tracking-widest">
                        #
                      </th>
                      <th className="px-6 py-4 text-left text-xs font-black text-slate-500 uppercase tracking-widest">
                        ID Number
                      </th>
                      <th className="px-6 py-4 text-left text-xs font-black text-slate-500 uppercase tracking-widest">
                        Name
                      </th>
                      <th className="px-6 py-4 text-left text-xs font-black text-slate-500 uppercase tracking-widest">
                        Program
                      </th>
                      <th className="px-6 py-4 text-left text-xs font-black text-slate-500 uppercase tracking-widest">
                        Year Level
                      </th>
                      <th className="px-6 py-4 text-left text-xs font-black text-slate-500 uppercase tracking-widest">
                        Email
                      </th>
                      <th className="px-6 py-4 text-left text-xs font-black text-slate-500 uppercase tracking-widest">
                        PIN
                      </th>
                      <th className="px-6 py-4 text-right text-xs font-black text-slate-500 uppercase tracking-widest">
                        Actions
                      </th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-slate-100">
                    {sortedStudents.map((student, idx) => (
                      <tr
                        key={student.id}
                        className="hover:bg-slate-50 transition-colors"
                      >
                        <td className="px-6 py-4 text-sm font-bold text-slate-400">
                          {idx + 1}
                        </td>
                        <td className="px-6 py-4 text-sm font-black text-blue-600">
                          {student.studentIdNum}
                        </td>
                        <td className="px-6 py-4 text-sm font-bold text-slate-800">
                          {student.name}
                        </td>
                        <td className="px-6 py-4 text-sm text-slate-600">
                          {student.program}
                        </td>
                        <td className="px-6 py-4 text-sm text-slate-600">
                          {student.yearLevel}
                        </td>
                        <td className="px-6 py-4 text-sm text-slate-500">
                          {student.email}
                        </td>
                        <td className="px-6 py-4">
                          <span className="px-3 py-1 bg-slate-100 rounded-lg text-xs font-mono font-bold text-slate-600">
                            {student.pin || "------"}
                          </span>
                        </td>
                        <td className="px-6 py-4 text-right">
                          <button
                            onClick={() =>
                              setStudentModal({
                                open: true,
                                mode: "edit",
                                data: student,
                              })
                            }
                            className="inline-flex items-center gap-2 px-4 py-2 bg-blue-100 text-blue-600 rounded-xl text-xs font-bold hover:bg-blue-600 hover:text-white transition-all mr-2"
                          >
                            <Icons.Edit /> Edit
                          </button>
                          <button
                            onClick={() => handleDeleteStudent(student.id)}
                            className="inline-flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-500 rounded-xl text-xs font-bold hover:bg-red-500 hover:text-white transition-all"
                          >
                            <Icons.Trash2 /> Delete
                          </button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
                {sortedStudents.length === 0 && (
                  <div className="py-12 text-center">
                    <Icons.Users className="text-slate-300 text-4xl mb-3 mx-auto" />
                    <p className="text-slate-400 font-bold">
                      No students registered yet.
                    </p>
                  </div>
                )}
              </div>

              <Modal
                isOpen={studentModal.open}
                onClose={() =>
                  setStudentModal({ open: false, mode: "add", data: {} })
                }
                title={
                  studentModal.mode === "add"
                    ? "Register New Student"
                    : "Edit Student"
                }
              >
                <div className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                        ID Number
                      </label>
                      <input
                        value={studentModal.data.studentIdNum || ""}
                        onChange={(e) =>
                          setStudentModal({
                            ...studentModal,
                            data: {
                              ...studentModal.data,
                              studentIdNum: e.target.value,
                            },
                          })
                        }
                        className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                        placeholder="2024-0001"
                      />
                      <p className="text-[10px] text-slate-400 mt-1">
                        Auto-generated
                      </p>
                    </div>
                    <div>
                      <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                        6-Digit PIN
                      </label>
                      <input
                        value={studentModal.data.pin || ""}
                        onChange={(e) =>
                          setStudentModal({
                            ...studentModal,
                            data: { ...studentModal.data, pin: e.target.value },
                          })
                        }
                        className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold font-mono"
                        placeholder="123456"
                        maxLength={6}
                      />
                      <p className="text-[10px] text-slate-400 mt-1">
                        For student login access
                      </p>
                    </div>
                  </div>
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      Full Name
                    </label>
                    <input
                      value={studentModal.data.name || ""}
                      onChange={(e) =>
                        setStudentModal({
                          ...studentModal,
                          data: { ...studentModal.data, name: e.target.value },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      placeholder="Garcia, Maria S."
                    />
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                        Program (Degree)
                      </label>
                      <select
                        value={studentModal.data.program || ""}
                        onChange={(e) =>
                          setStudentModal({
                            ...studentModal,
                            data: {
                              ...studentModal.data,
                              program: e.target.value,
                            },
                          })
                        }
                        className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      >
                        <option value="">Select program...</option>
                        <option>BSCS</option>
                        <option>BSIT</option>
                        <option>BS MATH</option>
                        <option>BS Physics</option>
                        <option>BS Chemistry</option>
                        <option>BS Biology</option>
                        <option>BA Comm</option>
                        <option>BSBA</option>
                        <option>BS Accountancy</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                        Year Level
                      </label>
                      <select
                        value={studentModal.data.yearLevel || ""}
                        onChange={(e) =>
                          setStudentModal({
                            ...studentModal,
                            data: {
                              ...studentModal.data,
                              yearLevel: e.target.value,
                            },
                          })
                        }
                        className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      >
                        <option>1st Year</option>
                        <option>2nd Year</option>
                        <option>3rd Year</option>
                        <option>4th Year</option>
                        <option>5th Year</option>
                      </select>
                    </div>
                  </div>
                  <div>
                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">
                      Email Address
                    </label>
                    <input
                      type="email"
                      value={studentModal.data.email || ""}
                      onChange={(e) =>
                        setStudentModal({
                          ...studentModal,
                          data: { ...studentModal.data, email: e.target.value },
                        })
                      }
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 font-bold"
                      placeholder="student@university.edu.ph"
                    />
                  </div>
                  <button
                    onClick={() => handleSaveStudent(studentModal.data)}
                    className="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 mt-4"
                  >
                    {studentModal.mode === "add"
                      ? "Register Student"
                      : "Save Changes"}
                  </button>
                </div>
              </Modal>
            </div>
          );
        };

        // DASHBOARD TAB
        const renderDashboard = () => {
          const totalStudents = data.students.length;
          const totalCourses = data.courses.length;
          const totalEnrollments = data.enrollments.length;
          const totalAssessments = data.assessments.length;

          return (
            <div className="space-y-6 animate-in">
              <div>
                <h2 className="text-2xl font-black text-slate-800">
                  Dashboard Overview
                </h2>
                <p className="text-xs text-slate-400 font-medium uppercase tracking-widest mt-1">
                  AcademicPro Statistics
                </p>
              </div>
              <div className="grid grid-cols-4 gap-6">
                <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                  <div className="w-12 h-12 rounded-xl bg-blue-100 flex items-center justify-center text-blue-600 mb-4">
                    <Icons.Users />
                  </div>
                  <h3 className="text-3xl font-black text-slate-800">
                    {totalStudents}
                  </h3>
                  <p className="text-sm text-slate-500">Total Students</p>
                </div>
                <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                  <div className="w-12 h-12 rounded-xl bg-purple-100 flex items-center justify-center text-purple-600 mb-4">
                    <Icons.BookOpen />
                  </div>
                  <h3 className="text-3xl font-black text-slate-800">
                    {totalCourses}
                  </h3>
                  <p className="text-sm text-slate-500">Total Courses</p>
                </div>
                <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                  <div className="w-12 h-12 rounded-xl bg-emerald-100 flex items-center justify-center text-emerald-600 mb-4">
                    <Icons.Users2 />
                  </div>
                  <h3 className="text-3xl font-black text-slate-800">
                    {totalEnrollments}
                  </h3>
                  <p className="text-sm text-slate-500">Enrollments</p>
                </div>
                <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                  <div className="w-12 h-12 rounded-xl bg-orange-100 flex items-center justify-center text-orange-600 mb-4">
                    <Icons.ClipboardList />
                  </div>
                  <h3 className="text-3xl font-black text-slate-800">
                    {totalAssessments}
                  </h3>
                  <p className="text-sm text-slate-500">Assessments</p>
                </div>
              </div>
            </div>
          );
        };

        if (loading) {
          return (
            <div className="flex h-screen items-center justify-center">
              <div className="text-center">
                <div className="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                <p className="text-slate-600 font-bold">Loading data...</p>
              </div>
            </div>
          );
        }

        return (
          <div className="flex h-screen bg-[#f8fafc] text-slate-800 font-sans overflow-hidden">
            <aside className="sidebar flex flex-col shrink-0 shadow-2xl z-20">
              <div className="p-8 flex items-center gap-4 text-white">
                <div className="bg-blue-500 p-2 rounded-xl shadow-lg shadow-blue-500/30">
                  <Icons.GraduationCap />
                </div>
                <span className="text-xl font-black tracking-tight uppercase">
                  Academic<span className="text-blue-400">Pro</span>
                </span>
              </div>
              <nav className="flex-1 px-4 space-y-2 mt-4 overflow-y-auto">
                <NavItem
                  icon={<Icons.LayoutDashboard />}
                  label="Dashboard"
                  active={activeTab === "Dashboard"}
                  onClick={() => setActiveTab("Dashboard")}
                />
                <NavItem
                  icon={<Icons.Users />}
                  label="Students"
                  active={activeTab === "Students"}
                  onClick={() => setActiveTab("Students")}
                />
                <NavItem
                  icon={<Icons.BookOpen />}
                  label="Courses"
                  active={activeTab === "Courses"}
                  onClick={() => setActiveTab("Courses")}
                />
                <NavItem
                  icon={<Icons.UserPlus />}
                  label="Enrollment"
                  active={activeTab === "Enrollment"}
                  onClick={() => setActiveTab("Enrollment")}
                />
                <div className="pt-8 pb-2 px-4">
                  <span className="text-[10px] font-black text-slate-500 uppercase tracking-[2px]">
                    Grade Portal
                  </span>
                </div>
                <NavItem
                  icon={<Icons.Target />}
                  label="Assessment & HPS"
                  active={activeTab === "Assessment"}
                  onClick={() => setActiveTab("Assessment")}
                />
                <NavItem
                  icon={<Icons.FileEdit />}
                  label="Grade Entry"
                  active={activeTab === "Grade Entry"}
                  onClick={() => setActiveTab("Grade Entry")}
                />
              </nav>
              <div className="p-4 border-t border-slate-700">
                <a
                  href="welcome_admin.html"
                  className="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-slate-700/50 transition-all"
                >
                  <Icons.LogOut />
                  <span className="text-sm font-bold">Sign Out</span>
                </a>
              </div>
            </aside>

            <main className="main-content flex flex-col overflow-hidden">
              <header className="h-20 flex items-center justify-between px-10 bg-white border-b border-slate-200/60">
                <div className="flex items-center gap-3 text-slate-400">
                  <span className="font-black text-[10px] tracking-widest uppercase">
                    Admin
                  </span>
                  <Icons.ChevronRight />
                  <span className="text-slate-800 font-bold tracking-tight uppercase tracking-widest text-[10px]">
                    {activeTab}
                  </span>
                </div>
                <div className="flex items-center gap-4">
                  <div className="bg-emerald-50 text-emerald-600 px-3 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest border border-emerald-100 flex items-center gap-2">
                    <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>{" "}
                    Online
                  </div>
                  <div className="w-10 h-10 rounded-2xl bg-slate-100 flex items-center justify-center font-black">
                    AD
                  </div>
                </div>
              </header>

              <div className="flex-1 overflow-y-auto p-10 bg-slate-50/40">
                {activeTab === "Dashboard" && renderDashboard()}
                {activeTab === "Students" && renderStudents()}
                {activeTab === "Courses" && renderCourses()}
                {activeTab === "Enrollment" && renderEnrollment()}
                {activeTab === "Assessment" && renderAssessments()}
                {activeTab === "Grade Entry" && renderGradeEntry()}
              </div>
            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
